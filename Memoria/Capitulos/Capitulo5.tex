%---------------------------------------------------------------------
%
%                          Capítulo 5
%
%---------------------------------------------------------------------

\chapter{Text2LSE}


En este capítulo se muestra el desarrollo que se ha realizado a lo largo de este proyecto. Text2LSE es una aplicación web (ver Figura~\ref {fig: imgWebText2LSE}) que permite traducir textos escritos en castellano a LSE en formato vídeo y en formato texto en tiempo real. Está basada en servicios web, los cuales están disponibles para todo el mundo de manera gratuita. Los vídeos que utilizan los servicios web del proyecto para realizar la traducción a LSE son recursos de los signos que ofrece el catálogo de LSE de ARASAAC. \\

En el apartado 5.1 se muestra la arquitectura de la aplicación web y cómo se comunica ésta con los servicios web. En el apartado 5.2 se explica en profundidad los servicios web desarrollados, tanto los utilizados en la aplicación web, como los desarrollados para aumentar las posibilidades de obtención de información para futuros desarrolladores. A continuación, en el apartado 5.3 se detalla más a fondo el desarrollo de la página web, tanto del diseño como de su funcionalidad. 

\begin{figure}[]
	\centering
	\includegraphics[width=1\textwidth]{Imagenes/Fuentes/Text2LSE/WebText2LSE.png}
	\caption{Aplicación web Text2LSE }
	\label {fig: imgWebText2LSE}
\end{figure}

%-------------------------------------------------------------------
\section{Arquitectura}
%-------------------------------------------------------------------
\label{cap4:sec:Arquitectura}

Text2LSE es una aplicación de traducción de castellano a LSE basada en servicios web, de manera que el código desarrollado sea fácilmente reutilizable. La arquitectura utilizada para el desarrollo de este proyecto es la arquitectura de cliente-servidor, es decir, un cliente muestra una web, la cual hace peticiones al servidor, que almacena los servicios web y devuelve la respuesta al cliente. Podemos ver un esquema de la arquitectura de este proyecto en la Figura~\ref {fig: imgArquitecturaText2LSE}.\\

Se ha optado por desarrollar una aplicación web debido a que ésta es accesible desde cualquier dispositivo que disponga de un navegador, ya sea un teléfono móvil, una tablet o un ordenador, sean de la marca y tamaño que sean. Para que se pueda ver de manera correcta en todos esos dispositivos, la aplicación web se ha desarrollado siguiendo un diseño responsive, es decir, que su visualización se adapte dependiendo de las dimensiones de la pantalla del dispositivo desde el cual se esté accediendo.\\

Respecto a la parte del servidor, se han desarrollado tres servicios web distintos, uno para devolver de manera rápida el vídeo en LSE de una sola palabra, otro para devolver el texto traducido a texto en LSE y otro para devolver el texto traducido a video en LSE. Al no disponer de una API que nos devolviese directamente los vídeos de la LSE de ARASAAC, se descargaron desde su página web y se almacenaron en el servidor para poder acceder a ellos.\\

Se ha utilizado un proxy inverso para poder acceder tanto a la página web como a los servicios web a través desde un mismo punto de acceso. Se han especificado una serie de rutas para diferenciar qué llamadas de usuario redireccionar a la página web y cuáles a los servicios web. Esta estructura se puede observar en la Figura~\ref {fig: imgProxy}.



\begin{figure}[]
	\centering
	
	\includegraphics[width=1\textwidth]{Imagenes/Fuentes/Text2LSE/ArquitecturaText2LSE.jpg}
	\caption{Arquitectura de Text2LSE }
	\label {fig: imgArquitecturaText2LSE}
\end{figure}

\begin{figure}[]
	\centering
	
	\includegraphics[width=1\textwidth]{Imagenes/Fuentes/Text2LSE/proxy.jpg}
	\caption{Esquema Proxy Inverso}
	\label {fig: imgProxy}
\end{figure}

\section{Back-End}

En esta sección se explican con detalle los servicios web desarrollados y su implementación. Para comenzar, en la sección 5.5.1 se detallan las funcionalidades de los tres servicios desarrollados, y posteriormente en la sección 5.5.2 se explica en profundidad la implementación de ellos haciendo uso de técnicas PLN.

%-------------------------------------------------------------------
\subsection{Servicios}
%-------------------------------------------------------------------
\label{cap4:sec:Servicios}

\subsubsection{Servicio web para obtener el video de un signo en LSE de una determinada palabra}

Este servicio permite obtener el video del signo en LSE correspondiente a una palabra determinada. Los videos utilizados en este servicio provienen del catálogo de vídeos de LSE de la web de ARASAAC. Para poder acceder a este servicio, se debe hacer una llamada GET a la API,  indicando la palabra que se desea traducir a LSE desde la siguiente url:\\

\begin{shaded}
	\url{https://holstein.fdi.ucm.es/tfg-text2lse/video/<palabra> }	
\end{shaded}

En el parámetro \textit{``palabra''} se debe indicar la palabra de la que se desea obtener su signo en LSE. \\

En caso de que se encuentre el vídeo de la palabra buscada, este servicio devuelve el vídeo deseado en formato mp4. En caso de que no se encuentre, devuelve un mensaje de error. Este flujo lo podemos observar en la Figura~\ref {fig: imgFlujo1palabraText2LSE}.

\begin{figure}[]
	\centering
	\includegraphics[width=0.7\textwidth]{Imagenes/Fuentes/Text2LSE/FlujoVideo1palabra.jpg}
	\caption{Flujo del servicio de Traducción de una palabra a vídeo en LSE}
	\label {fig: imgFlujo1palabraText2LSE}
\end{figure}


\subsubsection{Servicio web para Traducción de texto a vídeo en LSE}

Este servicio implementa la funcionalidad de traducción de un texto en castellano a LSE en formato video. Al igual que en el servicio anterior, los videos utilizados en este servicio provienen del catálogo de vídeos de LSE de la web de ARASAAC. Para poder acceder a este servicio, se debe realizar una petición POST a la API en la siguiente URL:\\

\begin{shaded}
	\url{https://holstein.fdi.ucm.es/tfg-text2lse/video/  }	
\end{shaded}


Los datos a enviar en la petición POST deben tener la siguiente estructura en JSON: 
\begin{center}

		\{ 'Texto' : '<texto>' \}

\end{center}


En el parámetro \textit{``texto''} se debe incluir el texto que se desea traducir a LSE. En caso de que se encuentren los recursos para traducir las palabras solicitadas a formato vídeo, se ejecuta un proceso que junta todos los vídeos en uno solo. Este vídeo es el que devuelve el servicio en formato mp4. Este flujo lo podemos observar en la Figura~\ref {fig: imgFlujoVideoTextoText2LSE}.

\begin{figure}[]
	\centering
	\includegraphics[width=1\textwidth]{Imagenes/Fuentes/Text2LSE/FlujoVideoTexto.jpg}
	\caption{ Flujo servicio de traducción de texto en castellano a video en LSE }
	\label {fig: imgFlujoVideoTextoText2LSE}
\end{figure}

\subsubsection{Servicio web para Traducción de texto en castellano a texto en LSE}
Este servicio implementa la funcionalidad de traducción de un texto en castellano a LSE en formato texto.
Para poder acceder a este servicio, se debe realizar una petición POST a la API en la siguiente URL:

\begin{shaded}
	\url{https://holstein.fdi.ucm.es/tfg-text2lse/TextoLSE}	
\end{shaded}


Los datos a enviar en la petición POST deben tener la siguiente estructura en JSON: 
\begin{center}
	
	\{ 'Texto' : '<texto>' \}
	
\end{center}

En el parámetro `texto'   se debe incluir el texto que se desea traducir a LSE. El flujo lo podremos ver en la Figura~\ref {fig: imgFlujoFlujoTextoLSE}. 

\begin{figure}[]
	\centering
	\includegraphics[width=1\textwidth]{Imagenes/Fuentes/Text2LSE/FlujoTextoLSE.png}
	\caption{ Flujo servicio de traducción de texto en castellano a texto en LSE }
	\label {fig: imgFlujoFlujoTextoLSE}
\end{figure}


\subsection{Procesamiento del Lenguaje Natural de TEXT2LSE}

Como se ha visto en el apartado anterior ambos Servicios Web necesitan realizar un Procesamiento de Lenguaje Natural para poder adaptar el texto escrito en castellano a la LSE. En este apartado se explicará la implementación y el desarrollo del PLN utilizado en ambos servicios.\\

El Procesamiento de Lenguaje Natural para el proyecto Text2LSE ha sido implementado desde cero por los tres integrantes del equipo. Debido a la singularidad de Lengua de Signos y la falta de documentación de otros servicios de PLN ya implementados de los cuales se podrían haber hecho uso, se llegó  a la conclusión de realizar un procesamiento propio utilizado únicamente la herramienta Spacy.\\

La implementación del PLN está basada en un sistema de reglas las cuales filtran qué palabras deben de ser utilizadas y cuales no. La elección a la hora de desarrollar el Procesamiento del Lenguaje para nuestro proyecto estaba entre un sistema basado en reglas o mediante el uso de aprendizaje automático. La opción de desarrollar un aprendizaje automático no era viable debido a la dificultad y la falta de ejemplos en castellano para entrenar el sistema. Por este motivo se eligió el sistema basado en reglas ya que era más fácil de implementar y aunque puede limitar la capacidad de traducción de frases que no cumplan dichas reglas, cumple con los objetivos marcados en el proyecto que es traducir frases simples y compuestas a LSE.\\

A continuación se explican las tres partes diferenciadas en el desarrollo del PLN.

\subsubsection{Recopilar la  información} 
Para poder empezar con el desarrollo se necesita conocer la información de cada palabra dentro de la oración. Para ello se realizará el proceso de Tokenización el cual divide la frase en una lista de palabras las cuales pasan a denominarse ?tokens? pero con la diferencia de que ahora cada token contiene gran cantidad de información. Esta información es:


\begin{itemize}
	
	\item \textbf{Dependencia:} función de la palabra dentro de la frase.
	\item \textbf{Tags:} información de la palabra como el género, el número, el tiempo verbal, etc.
	\item \textbf{Pos:} tipo de palabra como nombre, adjetivo, etc.
	\item \textbf{Lema:} Lema de palabra.	
	
\end{itemize}


Por ejemplo la información que se obtendría del token ?merendaban? sería ~\ref {fig: tokenInformacion}:
\begin{figure}[h]
	\centering
	\includegraphics[width=1\textwidth]{Imagenes/Fuentes/Text2LSE/tokenInformacion.png}
	\caption{ Información del token merendaban }
	\label {fig: tokenInformacion}
\end{figure}



\subsubsection{Análisis sintáctico y orden de la oración} 
Una vez separado la oración en tokens hay que diferenciar cuales forman parte del sujeto y cuales del predicado. Para ello hay que recorrer el árbol de dependencias  generado por Spacy mediante una función recursiva empezando desde el ROOT que es el token raíz del cual dependen todos los demás. Para entender cómo funcionan las dependencias se va a utilizar como ejemplo la oración `Ayer los niños merendaban chocolate'.

\begin{figure}[h]
	\centering
	\includegraphics[width=1\textwidth]{Imagenes/Fuentes/Text2LSE/dependencias.png}
	\caption{ Displacy grafo de dependencias }
	\label {fig: dependencias}
\end{figure}


Como se puede apreciar en el diagrama ~\ref {fig: dependencias} hay un token `merendaban'  del cual dependen tres tokens [Ayer, niños,chocolate]  y de ellos también dependen otros y así sucesivamente. \\

Estas dependencias se traducen en un árbol binario donde el ROOT es la raíz como podemos ver en la Figura~\ref {fig: grafo}:


\begin{figure}[]
	\centering
	\includegraphics[width=1\textwidth]{Imagenes/Fuentes/Text2LSE/grafo.png}
	\caption{ Árbol binario de una oración }
	\label {fig: grafo}
\end{figure}


\begin{itemize}
	
	\item \textbf{El sujeto:} Para poder obtener el sujeto hay que recorrer el árbol buscando un token que contenga la dependencia ``nsuj''. Una vez encontrado hay que volver a llamar a la función recursiva para obtener los hijos y guardarlos en una lista, pero no todos ellos formarán parte del sujeto. Por lo tanto mediante reglas se analiza qué palabras se descartan del nuevo sujeto de la oración en Lengua de Signos. En el ejemplo anterior ``Ayer los niños merendaban chocolate'':
	
	\begin{itemize}
		\item \textbf{Antes de PLN:}  [Los, niños]
		\item \textbf{Después  de PLN:}  [niños]
		
		
	\end{itemize}
	
	\newpage
	
	\item \textbf{El predicado:} El predicado se obtiene de manera muy parecida al sujeto. Como ya se ha encontrado un token con dependencia = ``nsuj'' y de él todos sus hijos, los demás tokens excepto el root, el cual se analiza de forma independiente, pertenecen al predicado y hay que analizarlos para ver si se descartan o no.
	
	Una vez completadas las reglas y se haya completado el recorrido del árbol ya se tendrá el predicado guardado en una lista. En el ejemplo ``Ayer los niños estaban en el parque'':
	
	\begin{itemize}
		\item \textbf{Antes de PLN:}  [Ayer, estaban, en, el, parque]
		\item \textbf{Después  de PLN:}  [Ayer,parque]
		
	\end{itemize}
	
	Una vez terminado el análisis sintáctico de la frase ``Ayer los niños estaban en el parque'' se obtiene el Sujeto: [niños], el Predicado: [Ayer,parque] y el Root: [estar]
	
	Como se ve la oración no tiene ningún sentido tan solo está separada sintácticamente po lo que ahora la 
	hay que ordenarla para que cumpla la estructura de la LSE. Para ello primero se recorren las listas del sujeto y del predicado generadas en el análisis sintáctico cuyos tokens van siendo ordenados mediante reglas.
	
	El orden general que se ha seguido para estructurar las frases ha sido el siguiente:
	
	\begin{center}
		PALABRAS DE TIEMPO + SUJETO + OBJETO + VERBO.
	\end{center}
	
	En el ejemplo utilizado anteriormente, la frase ordenada quedaría:
	
	``Ayer los niños merendaban chocolate en el parque'' quedaría ahora como  ``Ayer niños chocolate parque merendar''.
		
\end{itemize}


\subsubsection{Análisis morfológico} 
Una vez realizado el análisis sintáctico y orden de la oración hay que hacer un análisis morfológico detectando el tiempo verbal de la oración. el género y el número de cada token, así como los determinantes posesivos los cuales son sustituidos por pronombres personales.\\

Para entender mejor cómo funciona este apartado se va a usar de ejemplo la oración: ``Mis hermanos están de vacaciones''\\

Tiempo verbal: Si es PRESENTE la frase no se ve alterada, pero por ejemplo si está en PASADO o en FUTURO se añaden al principio de la frase los adverbios de tiempo ``ayer'' y ``mañana'' respectivamente ya que como se comentará en el siguiente apartado no tenemos suficientes palabras por lo que no podemos expresar el pasado o futuro de otra forma.

\section{Front-End}

En esta sección se explica en detalle la aplicación web desarrollada, cuya finalidad es proporcionar a los usuarios una interfaz sencilla donde puedan introducir el texto que desean traducir y obtengan el resultado por pantalla, haciendo uso de los servicios web de traducción implementados mediante llamadas Fetch. En la  Figura~\ref {fig: imgWebText2LSE} se muestra la interfaz de la aplicación, donde se puede observar que se han desarrollado dos funcionalidades:

\begin{itemize}

	\item \textbf{Traducción a vídeo:} esta sección consta de un input donde el usuario podrá introducir el texto en castellano que desee traducir, y tras pulsar el botón ``traducir'', se realizará una llamada Fetch al servidor proxy, que redirigirá la petición a la API. Una función Fetch se encargará de recibir el resultado de la petición, incrustando el vídeo en el código HTML. Así, se podrá visualizar por pantalla un vídeo en el que se podrá ver a un intérprete de ARASAAC realizando los signos LSE correspondientes.

	\item \textbf{Traducción a texto LSE:} de la misma manera que en la traducción a vídeo, en esta sección el usuario introducirá un texto en castellano y, tras pulsar el botón ``traducir'', se llamará a una función Fetch que realizará una petición a la url correspondiente. En caso de éxito aparecerá por pantalla dicho texto traducido a texto LSE.

\end{itemize}


En caso de error en cualquiera de las dos funcionalidades, la aplicación mostrará un modal con el tipo y detalle del error obtenido al realizar la petición a la API donde se encuentran nuestros servicios web.\\ 

Por otro lado, la interfaz también cuenta con un menú en la parte superior, donde además de a la página principal podemos acceder a una página con información sobre los miembros del equipo y de los tutores, y a otra con información sobre la aplicación. Todo ello se ha implementado siguiendo un diseño responsive, haciendo uso de Bootstrap 3, para garantizar que la herramienta sea accesible desde cualquier dispositivo. En la Figura~\ref {fig: imgResponsive} podemos observar la interfaz vista desde un dispositivo móvil.\\


\begin{figure}[]
	\centering
	\includegraphics[width=0.75\textwidth]{Imagenes/Fuentes/Text2LSE/responsive.jpg}
	\caption{ Aplicación Web vista desde un dispositivo móvil }
	\label {fig: imgResponsive}
\end{figure}



